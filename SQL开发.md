# 一、需求分析（9.12）
---
## 1.实体（现实世界对象调查）
| 实体 | 属性 | 行为 |
| :--- | :--- | :--- |
| **农田/地块 (Farmland)** | 唯一标识、地理坐标(GIS)、面积、土壤类型 | 被划分、可轮作、长期存在 |
| **作物 (Crop)** | 品种名称、生长周期（育苗、开花、结果等）、适宜温湿度、光照需求、常见病虫害 | 被种植、生长、收获、季节性强 |
| **设备 (Device)** | 设备ID、类型（气象站、土壤传感器、摄像头）、型号、所属地块、位置、状态（在线/离线）、电量 | 被部署、注册、定期上报数据、需要维护、可能故障 |
| **传感器数据 (Sensor Data)** | 时间戳、设备ID、指标类型（温度、湿度等）、数值单位、数据值 | 高频产生（每秒/每分钟）、随时间变化、具有时序性 |
| **图像/视频 (Media)** | 拍摄时间、拍摄设备ID、存储路径、文件格式、分辨率 | 被摄像头捕获、用于AI分析、需要长期或短期存储 |
| **病虫害 (Pest/Disease)** | 标准名称、学名、危害作物、症状描述、发病条件、传播途径 | 被识别、发生、发展、需要被预警和防治 |
| **识别结果 (Detection Result)** | 发生时间、发生位置、识别结果、置信度、图片证据 | 由AI模型触发 |
| **异常 (Exception)** | 发生时间、发生位置、异常状况、图片证据 | 由AI模型识别后触发、需要人工确认、导致预警 |
| **预警 (Alert)** | 触发时间、预警级别（蓝、黄、橙、红）、关联事件、处理状态 | 被系统自动生成、被用户查看、确认、处理、关闭 |
| **农事任务 (Task)** | 任务类型（灌溉、施肥、打药）、计划时间、执行人、状态、结果反馈 | 由系统建议或人工创建、被分配、被执行、被记录 |
| **用户 (User)** | 身份标识、角色（管理员、农技专家、农户）、权限、联系方式 | 注册、登录、操作系统、接收通知、执行任务 |


### **可能出现的流程事件**
* **正常数据收集**： 传感器收集数据 >> AI大模型进行分析 >> 识别结果正常 >> 生成环境数据 
* **出现异常数据**： “**数据收集**” >> 得到异常数据 >> 异常划分 >> 生成异常解决日志
* **异常情况预警**： “**出现异常数据**” >> 人工确认 >> 进行预警
* **农事操作** ：环境数据 >> AI大模型分析 >> 给出建议 >> 人工执行操作 >> 生成农事记录
* **用户信息更改**： 管理员对用户信息进行CRUD操作 >> 生成操作日志
* 
## 2. 需求分析 (The Requirements)

1.  **数据采集与存储**
    *   **需求**：每秒接收并存储成千上万个传感器节点的环境数据。
    *   **难点**：高频写入、海量数据、需高效查询近期和历史数据。
2.  **实时处理与计算**
    *   **需求**：对传感器数据进行实时清洗、聚合（如计算每小时平均温度）和异常检测。
1.  **非结构化数据管理**
    *   **需求**：存储和管理大量的作物图片、视频流以及AI模型文件。
    *   **解决**：**分布式文件存储系统minlo**非常适合于存储大容量非结构化的数据
2.  **智能识别与关联**
    *   **需求**：将AI识别结果（如：“发现番茄晚疫病”）与对应的地块、设备、原始图片关联起来。
3.  **预警与决策**
    *   **需求**：基于规则和模型（如：持续高湿+发现病斑）自动生成预警，并推送至相应用户。
4.  **数据溯源与操作记录**
    *   **需求**：能追溯任意一条数据的来源，以及任何关键操作（如：谁在何时下发了灌溉指令）。

## 3. 新数据库设计策略与可扩展性 (The Scalable Design)

基于以上分析，我们摒弃传统的单一数据库模式，采用**多模数据库（Multi-Model Database）** 架构，以充分满足不同需求并应对未来变化。

| 数据类别 | **推荐数据库技术** | **设计理由与扩展性考虑** |
| :--- | :--- | :--- |
| **设备元数据、业务关系数据**<br>(用户、地块、设备信息、任务记录) | **MySQL** | **关系型数据**，需要复杂的联表查询和事务支持（如用户权限管理）。PostgreSQL的JSONB和GIS地理信息扩展尤为强大。 |
| **高频传感器时序数据**<br>(温度、湿度、光照等) | **Cassandra** | **专为时序优化**：高效压缩、自动降采样、过期策略。**扩展性**：轻松应对设备数量和数据频率的指数级增长。 |
| **海量原始数据仓库**(冷数据、全量存档) | **HDFS** | **半结构化数据**，存储近期的传感器时序数据和AI识别结果，支撑实时监控、预警、大屏展示等高性能读写场景。 |
| **图片、视频、模型文件** | **对象存储**<br>**MinIO** | **海量非结构化数据**。**扩展性**：存储成本低，容量近乎无限，与计算资源解耦，易于扩展。 |
| **实时数据流** | **消息队列**<br>**Kafka** | 保障了系统在高负载下的稳定性和扩展性。利用kafka进行缓冲 |

**可扩展性设计要点：**

1.  **预留扩展字段**：在关键表中预留`extra_data`（JSON类型）字段，用于存储未来可能新增的非核心属性，避免频繁修改表结构。
2.  **微服务架构适配**：每个数据库都可作为独立微服务的数据存储，服务间通过API调用，可以提升系统的整体可扩展性和可维护性。

## 4. 总结

本数据库设计并非简单地创建一堆表，而是基于对现实业务的深刻理解，采用 **right tool for the right job** 的原则，选择一系列最适合特定数据类型的存储技术。这种设计：

*   **性能优越**：每种数据库都在其专长领域发挥极致性能。
*   **易于扩展**：每个组件都可以独立地进行水平和垂直扩展。
*   **适应变化**：灵活的 schema 或 schemaless 设计能够从容应对业务需求的不断演进。
*   **成本可控**：根据数据的热温冷属性，采用不同的存储策略，优化成本。

此方案为构建一个高性能、高可靠性的智慧农业平台奠定了坚实的数据基础。
